# pandey_et_al_2022
## overview 
Reproduction of MD ATP and ATP Pyrene simulation from *pandey et al (2022)*'s work. (https://pubs.acs.org/doi/full/10.1021/acs.jpcb.2c06077)
| System | ATP | Mg 2+ | Pyrene | NA + | CL -  | Simulation time (ns) | replicas |
|-  | - | -| -| - | - | - | - |
| ATP | 30 | 30 | 0 | 68 | 8 | 1000| 1 |
| ATP & pyrene  | 30 | 30 | 10 | 68 | 8 | 1000 | 3 |

# files
* `charmm36_ljpme-jul2021.ff` - CHARMM36 forcefield with modified ion charges
   * `ions.itp` - modified charges on CLA SOD MG by scaling of 0.6
* atp_pan
   * `old_topol.top` - original topology file without modified nucleotide charges
   * `scaledtopol.top` - scaled charge topology file 
   * `atp.pdb` - ATP PDB sourced from CHARMM-GUI Archive - Small molecule database: https://charmm-gui.org/?doc=archive&lib=csml

# ATP simulation without Mg 
* `gmx insert-molecules -ci atp.pdb -o atp_30box.pdb -box 5 5 5 -nmol 30` - generates a 5nm box with 30 atp molecules 
* `gmx pdb2gmx -f atp_30box.pdb -o atp30_pro.gro -water tip3p` - generates topology file
* topology is modified to scale charges refer to modified nucelotide charges below.
* `gmx solvate -cp atp30_pro.gro -cs spc216.gro -o atp_solv.gro -p topol.top`
* `gmx grompp -f ions.mdp -c atp_solv.gro -p topol.top -o ions.tpr`
* `gmx genion -s ions.tpr -o 1iee_solv_ions.gro -p topol.top -pname SOD -np 128 -nname CLA -nn 8 -rmin 0.5`

NOTE: using a smaller radius for ions and non solvent distance could cause crystal like structures..
Maybe useful to use `-gmx insert-molecules instead.`

* `gmx grompp -f minim.mdp -c 1iee_solv_ions.gro -p topol.top -o em.tpr`
* `gmx mdrun -v -deffnm em`
* Make index for [Non ATP] group `gmx make_ndx -f em.gro` for coupling in thermostat.
* `gmx grompp -f nvt.mdp -c em.gro -r em.gro -p topol.top -o nvt.tpr -n index.ndx`
* `gmx mdrun -v -deffnm nvt`
* `gmx grompp -f npt.mdp -c nvt.gro -r nvt.gro -t nvt.cpt -p topol.top -o npt.tpr -n index.ndx`
* `gmx mdrun -v -deffnm npt`
* `gmx grompp -f md.mdp -c npt.gro -t npt.cpt -p topol.top -o md_0_1.tpr -n index.ndx`
* `gmx mdrun -v -deffnm md_0_1`
* `gmx trjconv -s md_0_1.tpr -f md_0_1.xtc -o md_0_1_noPBC.xtc -pbc mol -center`

# ATP simulation with Mg

Additional Step required. (Does the MG required to be placed close to phosphate group or will it thermodynamically stabilise within?)

* `gmx genion -s ions.tpr -o 1iee_solv_ions.gro -p topol.top -pname SOD -np 68 -nname CLA -nn 8`
* `gmx genion -s ions.tpr -o 1iee_solv_ions.gro -p topol.top -pname MG -np 30`

## modified nucleotide charges (charmm36)
charges required to be scaled within `topol.top` generated by `gmx pdb2gmx`, shown via an example below. A charge scaling factor of 0.6 was used.  

| nr | type | resnr | residue | atom | cgnr  | charge | mass |
|-  | - | -| -| - | - | - | - |
| 28 | CN8B | 1 | ATP | C5' | 5 | -0.08 | 12.011 |
| 28 scaled| CN8B | 1 | ATP | C5' | 5 | -0.048 | 12.011 |

This is performed for all cgnr groups of multiple of 5s (this can vary but in my case nr 28 - 43 were scaled). This represents the phosphate group that contributes a charge of -4, rescaled to -2.4. The example topology for this simulation is `scaledtopol.top`. The ions were also scaled within `ions.itp` in forcefield. 

| | ATP | Mg 2+  | NA + | CL -  | Total |
|-  | - | -| - | - | - |
| molecules | 30 | 30 | 68 | 8 | 136| 
| scaled charge  | -72 | 36 | 40.8 | -4.8 | 0 | 
| molecules 2| 30 | 0 | 128 | 8 | 118 | 
| scaled charge 2  | -72 | 0 | 76.8 | -4.8 | 0 | 



# ATP Pyrene Simulation

# cluster size analysis

`gmx clustsize -f md_0_1_noPBC.xtc -s md_0_1.tpr -n index.ndx -mol yes` 



# gromacs
Gromacs Version 2021.5

## Notes from Pandey
Molecular Dynamics Simulations
We ran simulations with 30 negatively charged NTPs, 10 pyrene molecules solvated in water, and a bulk NaCl concentration of 0.1 M. The concentrations of NTPs and pyrenes were 400 and 130 mM, respectively. The concentrations used in the simulations are much higher than the concentration at which ATP starts acting as a hydrotrope. Simulating lower concentrations in MD are untenable because of the need to simulate very large simulation boxes containing few NTPs and an excessive number of water molecules. The molecules were initially distributed randomly in the simulation box, and the system was solvated with TIP3P (24) water molecules. A Mg2+ ion was placed close to the phosphate group of each NTP. ATP always binds a Mg2+ ion in its active form, and this is likely for the other NTPs as well. (17,25−27) To collect better statistics, we simulated three replicas for each system except the simulation of a single pyrene molecule in water. The list of performed simulations is shown in Table 1. 

Classical MD simulations were performed using Gromacs 2020.x. (28−32) using the Charmm36 force field (33−36) with modified nucleotide parameters (see below). An energy minimization was performed to eliminate the steric clashes. After minimization, equilibration was carried out under canonical (NVT) conditions. During equilibration, the modified Berendsen (V-rescale) thermostat (37) was used at a temperature of 310 K. For the production runs in the isothermal–isobaric (NPT) ensemble, Nose–Hoover temperature coupling (38,39) at 310 K and Parrinello–Rahman pressure coupling (40) at 1 bar were used. The Verlet cutoff scheme with a cutoff of 1.0 nm was used. Particle mesh Ewald (41,42) was used for the calculation of electrostatic interactions. The LINCS (43) algorithm was used to constrain all bonds containing hydrogen. A leap-frog integrator was used with a time step of 2.0 femtoseconds, and the simulation length for every system was 1000 ns. Trajectory frames were saved after every 10 000 steps. Each simulation was performed using a cubic box and periodic boundary conditions in all three dimensions. Analysis was performed using GROMACS and visualization with VMD. (44)
